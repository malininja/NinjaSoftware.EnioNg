@{
    ViewBag.Title = "Lista računa";
}

<h2>Lista računa</h2>

@Html.ActionLink("Novi račun", "RacunEdit", "Home")
<input type="button" value="Novi račun" onclick="alert('napravi kaj trebaš');" />

<table id="RacunTable"></table>
<div id="RacunTablePager"></div>

<script type="text/javascript">

    $("#RacunTable").jqGrid({
        url: "/JsonService/GetRacunGlavaCollectionForPaging",
        datatype: "json",
        colNames: ["Id", "Broj", "Partner", "Datum", "Iznos", "Status"],
        colModel: [
            { name: "RacunGlavaId", index: "RacunGlavaId", hidden: true },
            { name: "BrojRacuna", index: "BrojRacuna", width: 50, searchoptions: { clearSearch: false } },
            { name: "Partner.Naziv", index: "Partner.Naziv", width: 200, searchoptions: { clearSearch: false } },
            { name: "Datum", index: "Datum", width: 200, formatter: "date", formatoptions: { srcformat: "Y-m-d", newformat: "d.m.Y" }, search: false},
            { name: "Iznos", index: "Iznos", width: 200, align: "right", formatter: "number", formatoptions: { decimalSeparator: ",", decimalPlaces: 2 }, search: false },
            { name: "Status.Name", index: "Status.Name", width: 200, stype: "select",
				searchoptions: { sopt: ["eq"], value: ":--;1:Plaćen;2:Neplaćen;3:Storniran", clearSearch: false } },
        ],
        pager: "#RacunTablePager",
        caption: "Lista računa",
        onSelectRow: function (id) {
            var rowData = $(this).getRowData(id);
            var racunGlavaId = rowData["RacunGlavaId"];
            window.location.href = "/Home/RacunEdit?racunGlavaId=" + racunGlavaId;
        }
    }).filterToolbar({ groupOp: "AND", 
    	stringResult: true,
    	searchOnEnter: false,
    	beforeSearch: function () {
    		var $grid = $('#RacunTable');
    		var postData = $grid.jqGrid('getGridParam', 'postData');
    		var filters = $.parseJSON(postData.filters);
    		
    		if (filters && filters.rules && filters.rules.length > 0) {
    			for (var i = 0; i < filters.rules.length; i++) {
    				var rule = filters.rules[i];
    				
    				if (rule.field === "Status.Name") {
    					rule.field = "StatusId";
    				}
    			}
    			
    			postData.filters = JSON.stringify(filters);
    		}
    	}	 
    });;
</script>