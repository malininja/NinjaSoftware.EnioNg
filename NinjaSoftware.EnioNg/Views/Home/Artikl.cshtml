@{
    ViewBag.Title = "Artiklići";
}

<script src="@Url.Content("~/Scripts/Home/ArtiklController.js")" type="text/javascript"></script>

<div>

	<h2>Partner</h2>

	<input type="button" value="Dodaj novi artikl" onclick="openArtiklDialog();" />
		
	<table id="ArtiklTable"></table>
	<div id="ArtiklTablePager"></div>	
	<br /><br />
	
	<div id="ArtiklInput" ng-app>
	<div id="divNgController" ng-controller="ArtiklController">
		<table>
			<tr>
				<td>Naziv:</td>
				<td>
					<input ng-model="selectedArtikl.Naziv" />
				</td>
				<td>
					<span class="validation" name="RequiredField" ng-show="!validation.isNazivExist()"></span>
					<span class="validation" ng-show="!validation.isNazivValid()">Naziv ne može imati više od 100 znakova</span>
				</td>
			</tr>
			<tr>
				<td>Jedinica mjere:</td>
				<td>
					<input ng-model="selectedArtikl.Jm" />
				</td>
				<td>

				</td>
			</tr>
			<tr>
				<td>Pdv:</td>
				<td>
					<input ng-model="selectedArtikl.Pdv" />
				</td>
				<td>
					<span class="validation" name="RequiredField" ng-show="!validation.PdvExist()"></span>
					<span class="validation" ng-show="!validation.isAPdvValid()">Adresa ne može imati više od 100 znakova</span>
				</td>
			</tr>
			<tr>
				<td>Mjesto:</td>
				<td>
					<input ng-model="selectedArtikl.Cijena" />
				</td>
				<td>
					<span class="validation" name="RequiredField" ng-show="!validation.cijenaExist()"></span>
					<span class="validation" ng-show="!validation.isMjestoValid()">Mjesto ne može imati više od 20 znakova</span>
				</td>
			</tr>
			<tr id="tdAktivan" ng-show="!isSelectedArtiklNew()">
				<td>Aktivan:</td>
				<td>
					<input type="checkbox" ng-model="selectedArtikl.IsActive" />
				<td>
				<td></td>
			</tr>
		</table>
		<input type="button" value="Pohrani" ng-click="save()" />
		<input type="button" value="Odustani" onclick="closePartnerDialog()" />

	</div>
	</div>
</div>

<script type="text/javascript">
	var ngControllerScope;
	
	function getNgControllerScope() {
		if (!ngControllerScope) {
			ngControllerScope = angular.element($("#divNgController")).scope();
		}
		
		return ngControllerScope;
	}
	
	var dataAnnotations = DataAnnotations();
	$("span[name=RequiredField]").text(dataAnnotations.Required);
	
	$("#ArtiklInput").dialog({
		modal: true,
		width: "700px"
	});
	
	function closeArtiklDialog() {
		$("#ArtiklInput").dialog("close");
		
		var scope = getNgControllerScope();
		if (scope) {
			scope.clearArtikl();
		}
	}
	
	function openArtiklDialog() {
		$("#ArtiklInput").dialog("open");
	}
	
	$(document).on("ReloadArtiklGrid", function () {
		$("#ArtiklTable").trigger("reloadGrid");
	});
	
	closeArtiklDialog();
	
	$("#ArtiklTable").jqGrid({
		url: "/JqGrid/GetArtiklCollectionForPaging",
		datatype: "json",
		colNames: ["ArtiklId", "Naziv", "Jm", "Pdv", "Cijena", "Aktivan"],
		colModel: [
			{ name: "ArtiklId", index: "ArtiklId", hidden: true, width: 0 },
			{ name: "Naziv", index: "Naziv", width: 250, search : true },
			{ name: "Jm", index: "Oib", width: 90 },
			{ name: "Pdv", index: "Adresa", width: 200 },
			{ name: "Cijena", index: "Mjesto", width: 100 },
			{ name: "IsActive", index: "IsActive", width: 50, formatter: 'select', editoptions: { value: 'true:Da;false:Ne'} }
		],
		pager: "#ArtiklTablePager",
		caption: "Lista artikala",
		onSelectRow: function (id) {
			var rowData = $(this).getRowData(id);
			var scope = getNgControllerScope();
			scope.loadArtikl(rowData["ArtiklId"]);
			openArtiklDialog();
		}
	}).filterToolbar({ groupOp : 'AND', stringResult: true, searchOnEnter: false });
	
	$("#ArtiklTable").jqGrid("navGrid", "#ArtiklTablePager");
</script>